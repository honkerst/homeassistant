########################################################################
######## Itunes Playlists Automations for Input Boolean panel  #########
########################################################################
# NB The radio stations work by having only one radio station in a playlist named after the same radio station
# NB Add radio stations to playlists by finding the station's stream .m3u link (e.g. from https://www.internet-radio.com) and dragging the URL into a MUSIC playlist in iTunes
# NB 'Block Party' is a playlist created by the excellent Block Party AppleScript which I run once a day via an Automator action https://dougscripts.com/itunes/scripts/ss.php?sp=blockparty
########################################################################
# Start playlist and turn off other playlists 
- alias: Start playlist Block Party
  trigger:
    - platform: state
      entity_id: input_boolean.blockparty_gui
      to: "on"
  action:
    - service: switch.turn_on
      data:
        entity_id: 
          - switch.itunes_initial_play
    - service: media_player.play_media
      data:
        entity_id: media_player.itunes
        media_content_id: "block-party"
        media_content_type: playlist
    - service: media_player.volume_set
      data:
        entity_id: media_player.itunes
        volume_level: 0.3
    - service: input_number.set_value
      data_template:
        entity_id: input_number.airplay_volume
        value: 0.3
    - service: input_boolean.turn_off
      data:
        entity_id: 
          - input_boolean.radio2_gui
          - input_boolean.radio3_gui
          - input_boolean.radio4_gui
          - input_boolean.radio5_gui
          - input_boolean.talksport_gui
          - input_boolean.ozradio_gui
          - input_boolean.jazzradio_gui
          - input_boolean.podcasts_gui
- alias: Start playlist Radio 2
  trigger:
    - platform: state
      entity_id: input_boolean.radio2_gui
      to: "on"
  action:
    - service: switch.turn_on
      data:
        entity_id: 
          - switch.itunes_initial_play
    - service: media_player.play_media
      data:
        entity_id: media_player.itunes
        media_content_id: "radio2"
        media_content_type: playlist
    - service: media_player.volume_set
      data:
        entity_id: media_player.itunes
        volume_level: 0.3
    - service: input_number.set_value
      data_template:
        entity_id: input_number.airplay_volume
        value: 0.3
    - service: input_boolean.turn_off
      data:
        entity_id: 
          - input_boolean.radio3_gui
          - input_boolean.radio4_gui
          - input_boolean.radio5_gui
          - input_boolean.blockparty_gui
          - input_boolean.talksport_gui
          - input_boolean.ozradio_gui
          - input_boolean.jazzradio_gui
          - input_boolean.podcasts_gui
- alias: Start playlist Radio 3
  trigger:
    - platform: state
      entity_id: input_boolean.radio3_gui
      to: "on"
  action:
    - service: switch.turn_on
      data:
        entity_id: 
          - switch.itunes_initial_play
    - service: media_player.play_media
      data:
        entity_id: media_player.itunes
        media_content_id: "radio3"
        media_content_type: playlist
    - service: media_player.volume_set
      data:
        entity_id: media_player.itunes
        volume_level: 0.3
    - service: input_number.set_value
      data_template:
        entity_id: input_number.airplay_volume
        value: 0.3
    - service: input_boolean.turn_off
      data:
        entity_id: 
          - input_boolean.radio2_gui
          - input_boolean.radio4_gui
          - input_boolean.radio5_gui
          - input_boolean.blockparty_gui
          - input_boolean.talksport_gui
          - input_boolean.ozradio_gui
          - input_boolean.jazzradio_gui
          - input_boolean.podcasts_gui
- alias: Start playlist Radio 4
  trigger:
    - platform: state
      entity_id: input_boolean.radio4_gui
      to: "on"
  action:
    - service: switch.turn_on
      data:
        entity_id: 
          - switch.itunes_initial_play
    - service: media_player.play_media
      data:
        entity_id: media_player.itunes
        media_content_id: "radio4"
        media_content_type: playlist
    - service: media_player.volume_set
      data:
        entity_id: media_player.itunes
        volume_level: 0.3
    - service: input_number.set_value
      data_template:
        entity_id: input_number.airplay_volume
        value: 0.3
    - service: input_boolean.turn_off
      data:
        entity_id: 
          - input_boolean.blockparty_gui
          - input_boolean.radio2_gui
          - input_boolean.radio3_gui
          - input_boolean.radio5_gui
          - input_boolean.talksport_gui
          - input_boolean.ozradio_gui
          - input_boolean.jazzradio_gui
          - input_boolean.podcasts_gui
- alias: Start playlist Radio 5
  trigger:
    - platform: state
      entity_id: input_boolean.radio5_gui
      to: "on"
  action:
    - service: switch.turn_on
      data:
        entity_id: 
          - switch.itunes_initial_play
    - service: media_player.play_media
      data:
        entity_id: media_player.itunes
        media_content_id: "radio5live"
        media_content_type: playlist
    - service: media_player.volume_set
      data:
        entity_id: media_player.itunes
        volume_level: 0.3
    - service: input_number.set_value
      data_template:
        entity_id: input_number.airplay_volume
        value: 0.3
    - service: input_boolean.turn_off
      data:
        entity_id: 
          - input_boolean.blockparty_gui
          - input_boolean.radio2_gui
          - input_boolean.radio3_gui
          - input_boolean.radio4_gui
          - input_boolean.talksport_gui
          - input_boolean.ozradio_gui
          - input_boolean.jazzradio_gui
          - input_boolean.podcasts_gui
- alias: Start playlist TalkSport
  trigger:
    - platform: state
      entity_id: input_boolean.talksport_gui
      to: "on"
  action:
    - service: switch.turn_on
      data:
        entity_id: 
          - switch.itunes_initial_play
    - service: media_player.play_media
      data:
        entity_id: media_player.itunes
        media_content_id: "talksport"
        media_content_type: playlist
    - service: media_player.volume_set
      data:
        entity_id: media_player.itunes
        volume_level: 0.3
    - service: input_number.set_value
      data_template:
        entity_id: input_number.airplay_volume
        value: 0.3
    - service: input_boolean.turn_off
      data:
        entity_id: 
          - input_boolean.blockparty_gui
          - input_boolean.radio2_gui
          - input_boolean.radio3_gui
          - input_boolean.radio4_gui
          - input_boolean.radio5_gui
          - input_boolean.ozradio_gui
          - input_boolean.jazzradio_gui
          - input_boolean.podcasts_gui
- alias: Start playlist Oz radio
  trigger:
    - platform: state
      entity_id: input_boolean.ozradio_gui
      to: "on"
  action:
    - service: switch.turn_on
      data:
        entity_id: 
          - switch.itunes_initial_play
    - service: media_player.play_media
      data:
        entity_id: media_player.itunes
        media_content_id: "oz-radio"
        media_content_type: playlist
    - service: media_player.volume_set
      data:
        entity_id: media_player.itunes
        volume_level: 0.3
    - service: input_number.set_value
      data_template:
        entity_id: input_number.airplay_volume
        value: 0.3
    - service: input_boolean.turn_off
      data:
        entity_id: 
          - input_boolean.blockparty_gui
          - input_boolean.radio2_gui
          - input_boolean.radio3_gui
          - input_boolean.radio4_gui
          - input_boolean.radio5_gui
          - input_boolean.talksport_gui
          - input_boolean.jazzradio_gui
          - input_boolean.podcasts_gui
- alias: Start playlist Jazz radio
  trigger:
    - platform: state
      entity_id: input_boolean.jazzradio_gui
      to: "on"
  action:
    - service: switch.turn_on
      data:
        entity_id: 
          - switch.itunes_initial_play
    - service: media_player.play_media
      data:
        entity_id: media_player.itunes
        media_content_id: "jazz-radio"
        media_content_type: playlist
    - service: media_player.volume_set
      data:
        entity_id: media_player.itunes
        volume_level: 0.3
    - service: input_number.set_value
      data_template:
        entity_id: input_number.airplay_volume
        value: 0.3
    - service: input_boolean.turn_off
      data:
        entity_id: 
          - input_boolean.blockparty_gui
          - input_boolean.radio2_gui
          - input_boolean.radio3_gui
          - input_boolean.radio4_gui
          - input_boolean.radio5_gui
          - input_boolean.talksport_gui
          - input_boolean.ozradio_gui
          - input_boolean.podcasts_gui
- alias: Start playlist Podcasts
  trigger:
    - platform: state
      entity_id: input_boolean.podcasts_gui
      to: "on"
  action:
    - service: switch.turn_on
      data:
        entity_id: 
          - switch.itunes_initial_play
    - service: media_player.play_media
      data:
        entity_id: media_player.itunes
        # NB Give your podcasts playlist a name other than 'podcasts' otherwise it will select the entire Podcast library in iTunes 
        media_content_id: "podcastshuffle"
        media_content_type: playlist
    - service: media_player.volume_set
      data:
        entity_id: media_player.itunes
        volume_level: 0.3
    - service: input_number.set_value
      data_template:
        entity_id: input_number.airplay_volume
        value: 0.3
    - service: input_boolean.turn_off
      data:
        entity_id: 
          - input_boolean.blockparty_gui
          - input_boolean.radio2_gui
          - input_boolean.radio3_gui
          - input_boolean.radio4_gui
          - input_boolean.radio5_gui
          - input_boolean.talksport_gui
          - input_boolean.ozradio_gui
          - input_boolean.jazzradio_gui

########################################################################
# Test each 'Turn off' command so turning off the other 6 playlists doesn't trigger it 
########################################################################
- alias: Stop playlist - Block Party
  trigger:
    - platform: state
      entity_id: input_boolean.blockparty_gui
      to: "off"
  condition:
    - condition: template
      value_template: "{{ state_attr('media_player.itunes', 'media_playlist') == 'Block Party!' }}"
  action:
    - service: media_player.media_pause
      data:
        entity_id: media_player.itunes
- alias: Stop playlist - Radio 2
  trigger:
    - platform: state
      entity_id: input_boolean.radio2_gui
      to: "off"
  condition:
    - condition: template
      value_template: "{{ state_attr('media_player.itunes', 'media_playlist') == 'Radio2' }}"
  action:
    - service: media_player.media_pause
      data:
        entity_id: media_player.itunes
- alias: Stop playlist - Radio 3
  trigger:
    - platform: state
      entity_id: input_boolean.radio3_gui
      to: "off"
  condition:
    - condition: template
      value_template: "{{ state_attr('media_player.itunes', 'media_playlist') == 'Radio3' }}"
  action:
    - service: media_player.media_pause
      data:
        entity_id: media_player.itunes
- alias: Stop playlist - Radio 4
  trigger:
    - platform: state
      entity_id: input_boolean.radio4_gui
      to: "off"
  condition:
    - condition: template
      value_template: "{{ state_attr('media_player.itunes', 'media_playlist') == 'Radio4' }}"
  action:
    - service: media_player.media_pause
      data:
        entity_id: media_player.itunes
- alias: Stop playlist - Radio 5
  trigger:
    - platform: state
      entity_id: input_boolean.radio5_gui
      to: "off"
  condition:
    - condition: template
      value_template: "{{ state_attr('media_player.itunes', 'media_playlist') == 'Radio5live' }}"
  action:
    - service: media_player.media_pause
      data:
        entity_id: media_player.itunes
- alias: Stop playlist - TalkSport
  trigger:
    - platform: state
      entity_id: input_boolean.talksport_gui
      to: "off"
  condition:
    - condition: template
      value_template: "{{ state_attr('media_player.itunes', 'media_playlist') == 'TalkSport' }}"
  action:
    - service: media_player.media_pause
      data:
        entity_id: media_player.itunes
- alias: Stop playlist - Oz radio
  trigger:
    - platform: state
      entity_id: input_boolean.ozradio_gui
      to: "off"
  condition:
    - condition: template
      value_template: "{{ state_attr('media_player.itunes', 'media_playlist') == 'Oz radio' }}"
  action:
    - service: media_player.media_pause
      data:
        entity_id: media_player.itunes
- alias: Stop playlist - Jazz radio
  trigger:
    - platform: state
      entity_id: input_boolean.jazzradio_gui
      to: "off"
  condition:
    - condition: template
      value_template: "{{ state_attr('media_player.itunes', 'media_playlist') == 'Jazz radio' }}"
  action:
    - service: media_player.media_pause
      data:
        entity_id: media_player.itunes
- alias: Stop playlist - Podcasts
  trigger:
    - platform: state
      entity_id: input_boolean.podcasts_gui
      to: "off"
  condition:
    - condition: template
      value_template: "{{ state_attr('media_player.itunes', 'media_playlist') == 'Podcast shuffle' }}"
  action:
    - service: media_player.media_pause
      data:
        entity_id: media_player.itunes
########################################################################
# Sync Input Boolean when playlist re-starts 
# **** This is causing problems (returns to first item in playlist)
########################################################################
#- alias: Sync Block Party when restarting
#  trigger:
#    platform: state
#    entity_id: media_player.itunes
#    to: 'playing'
#  condition:
#    - condition: template
#      value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Block Party!' %}true{% endif %}"
#  action:
#    - service: input_boolean.turn_on
#      data:
#        entity_id: input_boolean.blockparty_gui
#- alias: Sync Radio2 when restarting
#  trigger:
#    platform: state
#    entity_id: media_player.itunes
#    to: 'playing'
#  condition:
#    - condition: template
#      value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Radio2' %}true{% endif %}"
#  action:
#    - service: input_boolean.turn_on
#      data:
#        entity_id: input_boolean.radio2_gui
#- alias: Sync Radio3 when restarting
#  trigger:
#    platform: state
#    entity_id: media_player.itunes
#    to: 'playing'
#  condition:
#    - condition: template
#      value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Radio3' %}true{% endif %}"
#  action:
#    - service: input_boolean.turn_on
#      data:
#        entity_id: input_boolean.radio3_gui
#- alias: Sync Radio4 when restarting
#  trigger:
#    platform: state
#    entity_id: media_player.itunes
#    to: 'playing'
#  condition:
#    - condition: template
#      value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Radio4' %}true{% endif %}"
#  action:
#    - service: input_boolean.turn_on
#      data:
#        entity_id: input_boolean.radio4_gui
#- alias: Sync Podcasts when restarting
#  trigger:
#    platform: state
#    entity_id: media_player.itunes
#    to: 'playing'
#  condition:
#    - condition: template
#      value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Podcasts' %}true{% endif %}"
#  action:
#    - service: input_boolean.turn_on
#      data:
#        entity_id: input_boolean.podcasts_gui
#- alias: Sync Jazz Radio when restarting
#  trigger:
#    platform: state
#    entity_id: media_player.itunes
#    to: 'playing'
#  condition:
#    - condition: template
#      value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Jazz Radio' %}true{% endif %}"
#  action:
#    - service: input_boolean.turn_on
#      data:
#        entity_id: input_boolean.jazz_radio_gui
#- alias: Sync Oz Radio when restarting
#  trigger:
#    platform: state
#    entity_id: media_player.itunes
#    to: 'playing'
#  condition:
#    - condition: template
#      value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Oz Radio' %}true{% endif %}"
#  action:
#    - service: input_boolean.turn_on
#      data:
#        entity_id: input_boolean.oz_radio_gui
########################################################################
# Sync Input Boolean to playlist status 
########################################################################
- alias: Sync all Input Booleans when iTunes paused
  trigger:
    platform: state
    entity_id: media_player.itunes
    from: 'playing'
#  condition:
#    condition: or
#    conditions:
#      - condition: state
#        entity_id: media_player.itunes
#        state: 'paused'
#      - condition: state
#        entity_id: media_player.itunes
#        state: 'stopped'
#      - condition: state
#        entity_id: media_player.itunes
#        state: 'idle'
  action:
    - service: input_boolean.turn_off
      data:
        entity_id: 
          - input_boolean.blockparty_gui
          - input_boolean.radio2_gui
          - input_boolean.radio3_gui
          - input_boolean.radio4_gui
          - input_boolean.radio5_gui
          - input_boolean.talksport_gui
          - input_boolean.jazzradio_gui
          - input_boolean.podcasts_gui
- alias: Sync playlist - Block Party
  trigger:
    platform: template
    value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Block Party!' %}true{% endif %}"
  condition:
    - condition: state
      entity_id: media_player.itunes
      state: 'playing'
  action:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.blockparty_gui
- alias: Sync playlist - Radio2
  trigger:
    platform: template
    value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Radio2' %}true{% endif %}"
  action:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.radio2_gui
- alias: Sync playlist - Radio3
  trigger:
    platform: template
    value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Radio3' %}true{% endif %}"
  action:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.radio3_gui
- alias: Sync playlist - Radio4
  trigger:
    platform: template
    value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Radio4' %}true{% endif %}"
  action:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.radio4_gui
- alias: Sync playlist - Radio5
  trigger:
    platform: template
    value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Radio5live' %}true{% endif %}"
  action:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.radio5_gui
- alias: Sync playlist - TalkSport
  trigger:
    platform: template
    value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'TalkSport' %}true{% endif %}"
  action:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.talksport_gui
- alias: Sync playlist - Oz Radio
  trigger:
    platform: template
    value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Oz radio' %}true{% endif %}"
  action:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.ozradio_gui
- alias: Sync playlist - Jazz Radio
  trigger:
    platform: template
    value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'Jazz radio' %}true{% endif %}"
  action:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.jazzradio_gui
- alias: Sync playlist - Podcast Shuffle
  trigger:
    platform: template
    value_template: "{% if state_attr('media_player.itunes', 'media_playlist') == 'PodcastShuffle' %}true{% endif %}"
  action:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.podcasts_gui
