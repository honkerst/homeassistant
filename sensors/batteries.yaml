########################################################################
########                    Template sensors                   #########
######################################################################## 'states.vacuum.xiaomivacuum.attributes.battery_level'
  - platform: template
    sensors:
      #
      # Vacuum
      #
      xiaomi_vacuum_battery:
        friendly_name: "Vacuum battery:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('vacuum.robovac', 'battery_level')|round(0) }}"
        icon_template: "{{ state_attr('vacuum.robovac', 'battery_icon') }}"
      #
      # Energy monitor 1
      #
      humidity_sensor_battery_loft:
        friendly_name: "Loft humidity sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('sensor.humidity_158d0004089a4c', 'battery_level')|round(0) }}"
        icon_template: >-
          {% set battery_level = states('sensor.humidity_sensor_battery_loft')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      humidity_sensor_battery_lcd_monitor:
        friendly_name: "LCD humidity monitor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('sensor.mi_h_582d3438aab9', 'battery_level')|round(0) }}"
        icon_template: >-
          {% set battery_level = states('sensor.humidity_sensor_battery_lcd_monitor')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_flood_sensor_bath:
        friendly_name: "Bath flood sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.water_leak_sensor_158d0004213267', 'battery_level')|round(0) }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_flood_sensor_bath')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_flood_sensor_kitchen:
        friendly_name: "Kitchen flood sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.water_leak_sensor_158d0002879b30', 'battery_level')|round(0) }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_flood_sensor_kitchen')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_front_door:
        friendly_name: "Front door sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.door_window_sensor_158d0003cd4254', 'battery_level')|round(0) }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_front_door')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_left_shed_door:
        friendly_name: "Left shed door sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.door_window_sensor_158d0004137f49', 'battery_level')|round(0) }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_left_shed_door')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_right_shed_door:
        friendly_name: "Right shed door sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.door_window_sensor_158d0003cd4077', 'battery_level')|round(0) }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_right_shed_door')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_side_alley_gate:
        friendly_name: "Side alley gate sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.door_window_sensor_158d0003cd4076', 'battery_level')|round(0) }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_side_alley_gate')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_fridge:
        friendly_name: "Fridge door sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.door_window_sensor_158d0002fd42a2', 'battery_level')|round(0) }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_fridge')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_freezer:
        friendly_name: "Freezer door sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.door_window_sensor_158d00032b7e3a', 'battery_level')|round(0) }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_freezer')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_dining_room_window:
        friendly_name: "Dining room window sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.door_window_sensor_158d0002fd436f', 'battery_level')|round(0) }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_dining_room_window')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_kitchen_window:
        friendly_name: "Kitchen window sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.door_window_sensor_158d0002c78cfb', 'battery_level')|round(0) }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_kitchen_window')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_landing:
        friendly_name: "Landing motion sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.landing_motion_sensor', 'battery') }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_landing')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_downstairs_loo:
        friendly_name: "Downstairs loo motion sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.motion_sensor_158d0002247bba', 'battery_level') }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_downstairs_loo')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_stairs:
        friendly_name: "Stairs motion sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.stairs_motion_sensor_motion', 'battery_level') }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_stairs')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_kitchen:
        friendly_name: "Kitchen motion sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.motion_sensor_158d0004239af0', 'battery_level') }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_kitchen')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_office:
        friendly_name: "Office motion sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.office_motion_sensor', 'battery') }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_office')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      motion_sensor_battery_porch:
        friendly_name: "Porch motion sensor:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('binary_sensor.motion_sensor_158d0003f131cf', 'battery_level') }}"
        icon_template: >-
          {% set battery_level = states('sensor.motion_sensor_battery_porch')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      switch_battery_living_room:
        friendly_name: "Living Room switch:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('sensor.living_room_switch', 'battery') }}"
        icon_template: >-
          {% set battery_level = states('sensor.switch_battery_living_room')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      switch_battery_dining_room:
        friendly_name: "Dining Room switch:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('sensor.dining_room_switch', 'battery') }}"
        icon_template: >-
          {% set battery_level = states('sensor.switch_battery_dining_room')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}
      switch_battery_office:
        friendly_name: "Office switch:"
        unit_of_measurement: '%'
        value_template: "{{ state_attr('sensor.office_switch', 'battery') }}"
        icon_template: >-
          {% set battery_level = states('sensor.switch_battery_office')|int('unknown') %}
          {% set battery_round = (battery_level|int / 10)|int * 10 %}
          {% if battery_level == 'unknown' %}
            mdi:battery-unknown
          {% else %}
            {% if battery_round >= 100 %}
              mdi:battery
            {% elif battery_round > 0 %}
              mdi:battery-{{ battery_round }}
            {% else %}
              mdi:battery-alert
            {% endif %}
          {% endif %}